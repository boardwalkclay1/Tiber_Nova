<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TimberNova — Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{margin:0;background:#020617;color:#f9fafb;font-family:system-ui,sans-serif;display:flex;flex-direction:column;min-height:100vh;}
    header,footer{padding:16px 24px;background:rgba(2,6,23,0.9);border-bottom:1px solid rgba(148,163,184,0.3);display:flex;justify-content:space-between;align-items:center;}
    footer{border-top:1px solid rgba(148,163,184,0.3);margin-top:auto;}
    main{padding:24px;max-width:1000px;margin:0 auto;flex:1;}
    nav button{border:none;background:none;color:#9ca3af;cursor:pointer;font-size:13px;margin-left:8px;}
    nav button:hover{color:#e5e7eb;}
    h1{font-size:22px;margin-bottom:8px;}
    .panel{background:rgba(15,23,42,0.9);border-radius:16px;border:1px solid rgba(148,163,184,0.3);padding:20px;margin-bottom:20px;}
    .input{width:100%;border-radius:10px;border:1px solid rgba(148,163,184,0.6);background:#0f172a;color:#e5e7eb;padding:10px;font-size:14px;margin-bottom:10px;}
    .pill-btn{border-radius:999px;padding:8px 14px;font-size:13px;cursor:pointer;border:none;background:linear-gradient(120deg,#22c55e,#4ade80);color:#022c22;margin-right:6px;}
    .pill-btn-ghost{border-radius:999px;padding:8px 14px;font-size:13px;cursor:pointer;border:1px solid rgba(148,163,184,0.5);background:#0f172a;color:#e5e7eb;margin-right:6px;}
    .profile-pic{width:120px;height:120px;border-radius:999px;background:#1e293b;border:2px solid rgba(148,163,184,0.4);margin-bottom:10px;object-fit:cover;}
    #qrCanvas{background:white;padding:10px;border-radius:12px;margin-top:10px;}
    .banner{border-radius:18px;padding:18px;margin-bottom:20px;display:flex;align-items:center;gap:16px;}
    .banner-info h2{margin:0 0 4px 0;font-size:18px;}
    .banner-info div{font-size:13px;color:#cbd5f5;}
  </style>
</head>
<body>

<header>
  <div>TimberNova • Profile</div>
  <nav>
    <button onclick="location.href='dashboard.html'">Dashboard</button>
    <button onclick="location.href='clients.html'">Clients</button>
    <button onclick="location.href='contracts.html'">Contracts</button>
    <button onclick="location.href='calendar.html'">Calendar</button>
    <button onclick="location.href='trees.html'">Trees</button>
    <button onclick="location.href='map.html'">Map</button>
    <button onclick="location.href='profile.html'">Profile</button>
    <button onclick="location.href='settings.html'">Settings</button>
    <button id="logout">Logout</button>
  </nav>
</header>

<main>
  <h1>Your Profile</h1>

  <!-- BANNER -->
  <div class="banner" id="profileBanner">
    <img id="profilePic" class="profile-pic" src="" alt="Profile Picture">
    <div class="banner-info">
      <h2 id="bannerName">Your Name</h2>
      <div id="bannerTagline">Tree work, mapped and dialed in.</div>
      <div id="bannerRole" style="opacity:0.8;"></div>
    </div>
  </div>

  <!-- PROFILE CONTROL -->
  <div class="panel">
    <h2 style="margin-top:0;">Account & Identity</h2>

    <input type="file" id="picUpload" class="input" accept="image/*">

    <input id="nameInput" class="input" placeholder="Name">
    <input id="emailInput" class="input" placeholder="Email">
    <input id="phoneInput" class="input" placeholder="Phone">
    <select id="roleInput" class="input">
      <option value="groundman">Groundman</option>
      <option value="climber">Climber</option>
      <option value="sales">Sales</option>
      <option value="owner">Owner</option>
    </select>
    <input id="serviceAreaInput" class="input" placeholder="Service area (e.g. Metro Atlanta)">
    <input id="taglineInput" class="input" placeholder="Banner tagline (e.g. Hazard removals, fast response)">
    <textarea id="bioInput" class="input" placeholder="Short bio / specialties" style="height:80px;"></textarea>

    <label style="font-size:13px;color:#9ca3af;">Banner color</label>
    <input id="bannerColorInput" class="input" type="color" value="#0f172a" style="padding:0;height:40px;">

    <button class="pill-btn" id="saveProfileBtn">Save Profile</button>
  </div>

  <!-- PUBLIC PROFILE / CLIENT PORTAL LINKS -->
  <div class="panel">
    <h2 style="margin-top:0;">Links & Portals</h2>
    <div style="color:#9ca3af;margin-bottom:10px;">
      These are the links you give to clients and crews.
    </div>

    <label style="font-size:13px;color:#9ca3af;">Public profile (lead capture)</label>
    <input id="publicLink" class="input" readonly>

    <label style="font-size:13px;color:#9ca3af;">Client portal (job status)</label>
    <input id="clientPortalLink" class="input" readonly>

    <button class="pill-btn" id="copyPublicLinkBtn">Copy Public Link</button>
    <button class="pill-btn-ghost" id="openPublicBtn">Open Public Page</button>
    <button class="pill-btn-ghost" id="openClientPortalBtn">Open Client Portal</button>
  </div>

  <!-- QR CODE -->
  <div class="panel">
    <h2 style="margin-top:0;">QR Code</h2>
    <div style="color:#9ca3af;margin-bottom:10px;">
      QR points to your public profile. Use it on cards, trucks, and flyers.
    </div>

    <canvas id="qrCanvas" width="200" height="200"></canvas>
    <button class="pill-btn" id="generateQRBtn">Generate QR</button>
  </div>

  <!-- CREW / REFERRALS -->
  <div class="panel">
    <h2 style="margin-top:0;">Crew & Referrals</h2>
    <button class="pill-btn-ghost" onclick="location.href='crew.html'">Crew Directory</button>
    <button class="pill-btn-ghost" onclick="location.href='clients.html'">Your Referrals</button>
  </div>

</main>

<footer>TimberNova • Profile</footer>

<script>
/* ---------- AUTH ENGINE ---------- */
function getCurrentUser(){
  try{return JSON.parse(localStorage.getItem("timberNovaUser")||"null");}
  catch{return null;}
}
function saveCurrentUser(u){
  localStorage.setItem("timberNovaUser",JSON.stringify(u));
}
function requireAuth(){
  if(!getCurrentUser())location.href="index.html";
}
requireAuth();
document.getElementById("logout").onclick=()=>{
  localStorage.removeItem("timberNovaUser");
  location.href="index.html";
};

/* ---------- LOAD USER & INIT ---------- */
let u=getCurrentUser();
if(!u.id){
  u.id=Math.random().toString(36).slice(2)+Date.now().toString(36);
  saveCurrentUser(u);
}

const nameInput=document.getElementById("nameInput");
const emailInput=document.getElementById("emailInput");
const phoneInput=document.getElementById("phoneInput");
const roleInput=document.getElementById("roleInput");
const serviceAreaInput=document.getElementById("serviceAreaInput");
const taglineInput=document.getElementById("taglineInput");
const bioInput=document.getElementById("bioInput");
const bannerColorInput=document.getElementById("bannerColorInput");
const profilePic=document.getElementById("profilePic");
const banner=document.getElementById("profileBanner");
const bannerName=document.getElementById("bannerName");
const bannerTagline=document.getElementById("bannerTagline");
const bannerRole=document.getElementById("bannerRole");

nameInput.value=u.name||"";
emailInput.value=u.email||"";
phoneInput.value=u.phone||"";
roleInput.value=u.role||"groundman";
serviceAreaInput.value=u.serviceArea||"";
taglineInput.value=u.tagline||"Tree work, mapped and dialed in.";
bioInput.value=u.bio||"";
bannerColorInput.value=u.bannerColor||"#0f172a";
profilePic.src=u.photo||"";
banner.style.background=u.bannerColor||"#0f172a";
bannerName.textContent=u.name||"Your Name";
bannerTagline.textContent=u.tagline||"Tree work, mapped and dialed in.";
bannerRole.textContent=(u.role?u.role.charAt(0).toUpperCase()+u.role.slice(1):"")+(u.serviceArea?` • ${u.serviceArea}`:"");

/* ---------- PROFILE PIC ENGINE ---------- */
document.getElementById("picUpload").onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=()=>{
    profilePic.src=reader.result;
    u.photo=reader.result;
    saveCurrentUser(u);
  };
  reader.readAsDataURL(file);
};

/* ---------- SAVE PROFILE ENGINE ---------- */
document.getElementById("saveProfileBtn").onclick=()=>{
  u.name=nameInput.value.trim();
  u.email=emailInput.value.trim();
  u.phone=phoneInput.value.trim();
  u.role=roleInput.value;
  u.serviceArea=serviceAreaInput.value.trim();
  u.tagline=taglineInput.value.trim()||"Tree work, mapped and dialed in.";
  u.bio=bioInput.value.trim();
  u.bannerColor=bannerColorInput.value||"#0f172a";

  saveCurrentUser(u);

  banner.style.background=u.bannerColor;
  bannerName.textContent=u.name||"Your Name";
  bannerTagline.textContent=u.tagline;
  bannerRole.textContent=(u.role?u.role.charAt(0).toUpperCase()+u.role.slice(1):"")+(u.serviceArea?` • ${u.serviceArea}`:"");

  alert("Profile saved.");
};

/* ---------- LINK ENGINE ---------- */
const origin=location.origin;
const publicUrl=origin+"/u.html?id="+u.id;
const clientPortalUrl=origin+"/client.html?id="+u.id;

document.getElementById("publicLink").value=publicUrl;
document.getElementById("clientPortalLink").value=clientPortalUrl;

document.getElementById("copyPublicLinkBtn").onclick=()=>{
  navigator.clipboard.writeText(publicUrl);
  alert("Public link copied.");
};
document.getElementById("openPublicBtn").onclick=()=>{
  window.open(publicUrl,"_blank");
};
document.getElementById("openClientPortalBtn").onclick=()=>{
  window.open(clientPortalUrl,"_blank");
};

/* ---------- QR ENGINE (pure JS) ---------- */
function drawQR(text){
  const canvas=document.getElementById("qrCanvas");
  const ctx=canvas.getContext("2d");
  ctx.fillStyle="white";
  ctx.fillRect(0,0,200,200);

  let hash=0;
  for(let i=0;i<text.length;i++){
    hash=(hash<<5)-hash+text.charCodeAt(i);
    hash|=0;
  }

  ctx.fillStyle="black";
  for(let y=0;y<21;y++){
    for(let x=0;x<21;x++){
      const v=(hash>>(x*y+ y + x))&1;
      if(v)ctx.fillRect(x*9,y*9,9,9);
    }
  }
}

document.getElementById("generateQRBtn").onclick=()=>{
  drawQR(publicUrl);
};
</script>

</body>
</html>
