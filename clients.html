<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TimberNova — Clients</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{margin:0;background:#020617;color:#f9fafb;font-family:system-ui,sans-serif;display:flex;flex-direction:column;min-height:100vh;}
    header,footer{padding:16px 24px;background:rgba(2,6,23,0.9);border-bottom:1px solid rgba(148,163,184,0.3);display:flex;justify-content:space-between;align-items:center;}
    footer{border-top:1px solid rgba(148,163,184,0.3);border-bottom:none;margin-top:auto;}
    main{padding:24px;max-width:1100px;margin:0 auto;flex:1;}
    nav button{border:none;background:none;color:#9ca3af;cursor:pointer;font-size:13px;margin-left:8px;}
    nav button:hover{color:#e5e7eb;}
    h1{font-size:22px;margin-bottom:8px;}
    h2{font-size:18px;margin:16px 0 8px;}
    .sub{color:#9ca3af;font-size:14px;margin-bottom:16px;}
    .panel{background:rgba(15,23,42,0.9);border-radius:16px;border:1px solid rgba(148,163,184,0.3);padding:16px;margin-bottom:16px;}
    .input{width:100%;border-radius:10px;border:1px solid rgba(148,163,184,0.6);background:rgba(15,23,42,0.9);color:#e5e7eb;padding:8px 10px;font-size:13px;margin-bottom:8px;}
    .pill-btn{border-radius:999px;padding:7px 12px;font-size:13px;cursor:pointer;border:none;background:linear-gradient(120deg,#22c55e,#4ade80);color:#022c22;}
    .result-item{border-bottom:1px solid rgba(148,163,184,0.3);padding:8px 0;font-size:13px;cursor:pointer;}
    .result-item:last-child{border-bottom:none;}
  </style>
</head>
<body>
<header>
  <div>TimberNova • Clients</div>
  <nav>
    <button onclick="location.href='dashboard.html'">Dashboard</button>
    <button onclick="location.href='clients.html'">Clients</button>
    <button onclick="location.href='contracts.html'">Contracts</button>
    <button onclick="location.href='calendar.html'">Calendar</button>
    <button onclick="location.href='trees.html'">Trees</button>
    <button onclick="location.href='map.html'">Map</button>
    <button onclick="location.href='profile.html'">Profile</button>
    <button onclick="location.href='settings.html'">Settings</button>
    <button id="logout">Logout</button>
  </nav>
</header>

<main>
  <h1>Clients</h1>
  <div class="sub">Manage clients, addresses, and jobs.</div>

  <div class="panel">
    <h2>New client</h2>
    <input id="clientName" class="input" placeholder="Name" />
    <input id="clientPhone" class="input" placeholder="Phone" />
    <input id="clientEmail" class="input" placeholder="Email" />
    <input id="clientAddress" class="input" placeholder="Address" />
    <textarea id="clientNotes" class="input" placeholder="Notes" style="height:60px;"></textarea>
    <button class="pill-btn" id="saveClientBtn">Save client</button>
  </div>

  <h2>All clients</h2>
  <input id="clientSearch" class="input" placeholder="Search by name, address, phone..." />
  <div id="clientList"></div>
</main>

<footer>TimberNova • Clients</footer>

<script>
function getCurrentUser(){try{return JSON.parse(localStorage.getItem("timberNovaUser")||"null");}catch{return null;}}
function requireAuth(){if(!getCurrentUser())window.location.href="index.html";}
function loadClients(){try{return JSON.parse(localStorage.getItem("timberNovaClients")||"[]");}catch{return[];}}
function saveClients(list){localStorage.setItem("timberNovaClients",JSON.stringify(list));}
function id(){return Math.random().toString(36).slice(2)+Date.now().toString(36);}

requireAuth();
document.getElementById("logout").onclick=()=>{localStorage.removeItem("timberNovaUser");window.location.href="index.html";};

const listEl=document.getElementById("clientList");
const searchEl=document.getElementById("clientSearch");

function renderClients(){
  const q=searchEl.value.toLowerCase();
  const clients=loadClients().filter(c=>
    c.name.toLowerCase().includes(q)||
    (c.address||"").toLowerCase().includes(q)||
    (c.phone||"").toLowerCase().includes(q)
  );
  if(!clients.length){listEl.innerHTML="<div style='color:#9ca3af;'>No clients yet.</div>";return;}
  listEl.innerHTML=clients.map(c=>`
    <div class="result-item" onclick="location.href='client-detail.html?id=${c.id}'">
      <strong>${c.name}</strong> — ${c.address||"No address"}<br/>
      <span style="color:#9ca3af;">${c.phone||""} ${c.email||""}</span>
    </div>
  `).join("");
}

document.getElementById("saveClientBtn").onclick=async()=>{
  const name=document.getElementById("clientName").value.trim();
  const phone=document.getElementById("clientPhone").value.trim();
  const email=document.getElementById("clientEmail").value.trim();
  const address=document.getElementById("clientAddress").value.trim();
  const notes=document.getElementById("clientNotes").value.trim();
  if(!name){alert("Name required.");return;}
  const clients=loadClients();
  const client={id:id(),name,phone,email,address,notes,lat:null,lng:null};
  if(address){
    try{
      const res=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`);
      const data=await res.json();
      if(data&&data[0]){client.lat=parseFloat(data[0].lat);client.lng=parseFloat(data[0].lon);}
    }catch(e){console.log("Geocode failed",e);}
  }
  clients.push(client);saveClients(clients);
  document.getElementById("clientName").value="";
  document.getElementById("clientPhone").value="";
  document.getElementById("clientEmail").value="";
  document.getElementById("clientAddress").value="";
  document.getElementById("clientNotes").value="";
  renderClients();
};

searchEl.addEventListener("input",renderClients);
renderClients();
</script>
</body>
</html>
